<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>일본어 단어 퀴즈 + 예문 학습</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
/* CSS 스타일: 기존 디자인 유지 */
:root{ --bg:#f7f9fc; --text:#0f172a; --muted:#5b6476; --card:#ffffff; --ring:#d9e1ff; --accent:#2563eb; --shadow:0 10px 30px rgba(7,14,48,.06); --secondary: #e74c3c; }
*{ box-sizing:border-box }
body{ margin:0; font-family:Pretendard, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif; background:var(--bg); color:var(--text); line-height:1.6 }
.container{ max-width:900px; margin:26px auto; padding:0 16px }
h1{ margin:0 0 12px; font-size:28px }
.toolbar{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:14px }
.btn{ border:1px solid #cfd7ee; background:#fff; border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer; box-shadow:var(--shadow); transition: all 0.2s }
.btn:hover{ background:#f3f6ff }
.btn.primary{ background:var(--accent); color:#fff; border-color:transparent }
.btn.primary:hover{ background:#1d4ed8 }
.btn.ghost{ background:#f6f8ff }
input[type="number"]{ width:72px; padding:8px 10px; border:1px solid #d4dcf4; border-radius:10px; font-weight:600; box-shadow:var(--shadow) }
.hint{ color:var(--muted); font-size:13px }

/* 카드 및 문제/정답 스타일 */
.card{ background:var(--card); border:1px solid #e6ecff; border-radius:16px; padding:14px; box-shadow:var(--shadow); margin:18px 0 }
/* 문제: 단어 */
.question{ font-size:26px; font-weight:800; letter-spacing:.2px; padding:20px 16px; border:1px solid #e4e9fb; border-radius:12px; background:#fbfdff; color:var(--secondary); text-align: center; } 

/* 정답 영역 */
.answer{ position:relative; margin-top:14px; padding:18px; border-radius:12px; background:#f7f9ff; color:var(--text); border:1px dashed #cdd7fb }
.answer.hidden .blur{ filter: blur(7px); opacity:.65; transition: filter 0.3s, opacity 0.3s }
.answer .label{ font-size:12px; color:var(--muted); margin-bottom:6px }
.answer .line{ font-size:18px; font-weight:700 }

/* 핵심 정답 강조 */
.answer .core-answer {
    font-size: 20px;
    color: var(--accent);
    margin-bottom: 10px;
}
/* 예문 섹션 구분 */
.example-section {
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #e0e8ff;
}
.example-section .label {
    color: var(--secondary);
    font-weight: 600;
}
.example-section .line {
    font-size: 16px;
    font-weight: 400;
}


.row{ display:flex; justify-content:flex-end; margin-top:12px }
.pill{ border:1px solid #d4dcf4; background:#fff; padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:var(--shadow); transition: all 0.2s }
.pill:hover{ background:#f3f6ff }
.top-note{ margin:4px 0 18px; font-size:12px; color:var(--muted); line-height: 1.4 }
input[type=file]{ display:none }

/* 모바일 대응 */
@media (max-width: 600px) {
    .toolbar {
        flex-direction: column;
        align-items: stretch;
    }
    .toolbar > * {
        margin: 5px 0 !important;
    }
    input[type="number"] {
        width: 100%;
    }
    .row {
        justify-content: center;
    }
}
</style>
</head>
<body>
  <div class="container">
    <h1>일본어 단어 퀴즈 (예문 확인)</h1>
    <div class="toolbar">
      <button class="btn primary" id="shuffleBtn">무작위 섞기</button>
      <label class="hint">반복:</label>
      <input id="repeatInput" type="number" min="1" value="1" />
      <label class="btn" for="xlsxInput">파일 선택 (재로딩)</label>
      <input id="xlsxInput" type="file" accept=".xlsx,.xls" />
      <button class="btn ghost" id="revealAll">전체 정답 보기</button>
      <button class="btn ghost" id="hideAll">전체 가리기</button>
    </div>
    <span id="dataStatus" class="top-note">
        엑셀(<b>japanese.xlsx</b>) 6개 열 순서를 확인해 주세요:<br>
        A:**단어(問題)** B:단어발음 C:**단어뜻(正解)** D:예문 E:예문뜻 F:예문발음
    </span>

    <div id="list"></div>
  </div>

<script>
  // 학습 데이터 배열
  let baseData = [];
  
  const $ = (id) => document.getElementById(id);
  const listEl = $('list');
  const dataStatusEl = $('dataStatus');

  // --- 1. 카드 생성 함수 (단어 퀴즈 + 예문 제시) ---
  function makeCard(item){
    const wrap = document.createElement('div');
    wrap.className = 'card';

    // 문제 영역: A열 (일본어 단어)를 문제로 제시
    const q = document.createElement('div');
    q.className = 'question';
    // 단어에 후리가나(B열)가 있다면 같이 표시 (정답 유추를 돕기 위해)
    q.textContent = item.word + (item.word_furi ? ' [' + item.word_furi + ']' : ''); 

    // 정답 영역 (C: 단어 뜻, D/E/F: 예문 정보)
    const a = document.createElement('div');
    a.className = 'answer hidden';

    // C열: 단어 한국어 뜻 (핵심 정답)
    const wordKrRow = document.createElement('div');
    wordKrRow.innerHTML = `<div class="label">단어 뜻 (정답)</div><div class="line core-answer blur">${item.word_kr}</div>`;

    // 예문 섹션 (D, E, F열)
    const exampleSection = document.createElement('div');
    exampleSection.className = 'example-section';
    
    // D열: 일본어 예문
    const exampleJpRow = document.createElement('div');
    exampleJpRow.innerHTML = `<div class="label">예문 (일본어)</div><div class="line blur">${item.example}</div>`;
    
    // F열: 예문 발음 (후리가나)
    const exampleFuriRow = document.createElement('div');
    exampleFuriRow.innerHTML = `<div class="label">예문 발음 (후리가나)</div><div class="line blur">${item.example_furi}</div>`;
    
    // E열: 예문 한국어 뜻
    const exampleKrRowIn = document.createElement('div');
    exampleKrRowIn.innerHTML = `<div class="label">예문 뜻 (한국어)</div><div class="line blur">${item.example_kr}</div>`;

    exampleSection.appendChild(exampleJpRow);
    exampleSection.appendChild(exampleFuriRow);
    exampleSection.appendChild(exampleKrRowIn);
    
    a.appendChild(wordKrRow); 
    // 예문 내용이 있을 때만 섹션 추가
    if (item.example) {
        a.appendChild(exampleSection);
    }

    // 정답 보기/가리기 버튼
    const row = document.createElement('div'); row.className='row';
    const btn = document.createElement('button'); btn.className='pill'; btn.textContent='정답';
    
    btn.addEventListener('click', ()=>{ 
      a.classList.toggle('hidden'); 
      btn.textContent = a.classList.contains('hidden') ? '정답' : '가리기'; 
    });
    row.appendChild(btn);

    wrap.appendChild(q); 
    wrap.appendChild(a); 
    wrap.appendChild(row);
    return wrap;
  }

  // --- 2. 렌더링 함수 ---
  function render(data){
    listEl.innerHTML='';
    const repeat = Math.max(1, parseInt($('repeatInput').value||'1', 10));
    const items = [];
    
    for(let r=0;r<repeat;r++) items.push(...data);
    
    items.forEach(it=> listEl.appendChild(makeCard(it)) );
    dataStatusEl.textContent += ` (총 ${data.length}개 단어/예문 로드됨)`;
  }

  // --- 3. 유틸리티 및 엑셀 파싱 함수 ---
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){ 
      const j=Math.floor(Math.random()*(i+1)); 
      [arr[i],arr[j]]=[arr[j],arr[i]]; 
    }
  }
  
  // 엑셀 rows를 6개 컬럼 형식으로 변환 (A~F열 순서)
  function normalizeRows(rows){
    if (rows.length === 0) return [];
    
    return rows.map(r=>{
      const keys = Object.keys(r);
      return {
        word: r[keys[0]] ?? '', // A열: 일본어 단어 (문제)
        word_furi: r[keys[1]] ?? '', // B열: 단어 후리가나
        word_kr: r[keys[2]] ?? '', // C열: 단어 한국어 뜻 (핵심 정답)
        example: r[keys[3]] ?? '', // D열: 일본어 예문
        example_kr: r[keys[4]] ?? '', // E열: 예문 한국어 뜻
        example_furi: r[keys[5]] ?? '', // F열: 예문 후리가나
      }
    }).filter(x => x.word); // 단어(A열)가 있는 유효한 행만 사용
  }
  
  // --- 4. 이벤트 리스너 ---
  
  $('shuffleBtn').onclick = ()=>{ shuffle(baseData); render(baseData); };
  $('repeatInput').addEventListener('change', ()=> render(baseData));
  
  $('revealAll').onclick = ()=>{
    document.querySelectorAll('.answer').forEach(el=>el.classList.remove('hidden'));
    document.querySelectorAll('.pill').forEach(b=>b.textContent='가리기');
  };
  
  $('hideAll').onclick = ()=>{
    document.querySelectorAll('.answer').forEach(el=>el.classList.add('hidden'));
    document.querySelectorAll('.pill').forEach(b=>b.textContent='정답');
  };

  // 엑셀 파일 업로드 및 처리
  $('xlsxInput').addEventListener('change', async (e)=>{
    const file = e.target.files?.[0]; 
    if(!file) return;

    try {
      dataStatusEl.textContent = `"${file.name}" 파일을 읽는 중...`;
      
      const buf = await file.arrayBuffer();
      const wb = XLSX.read(buf, {type:'array'});
      const ws = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, {defval:''}); 
      const normalized = normalizeRows(rows);
      
      if(normalized.length){ 
        baseData = normalized; 
        render(baseData); 
        dataStatusEl.textContent = `"${file.name}" 로드 완료. (총 ${baseData.length}개 단어)`;
      } else {
        alert('엑셀을 읽었으나 유효한 데이터(A열)가 없습니다. 6개 열 순서를 확인해주세요.');
        dataStatusEl.textContent = '유효한 엑셀 데이터를 찾을 수 없습니다.';
      }
    } catch (err) {
      console.error('파일 처리 오류:', err);
      alert('엑셀 파일을 처리하는 도중 오류가 발생했습니다.');
      dataStatusEl.textContent = '파일 처리 중 오류 발생.';
    }
    e.target.value = ''; 
  });

  // --- 5. 초기 실행 (같은 폴더의 japanese.xlsx 자동 로딩 시도) ---
  (async ()=>{
    try{
      const res = await fetch('japanese.xlsx');
      if(!res.ok){
        throw new Error('파일을 찾거나 읽을 수 없습니다. (HTTP Status: ' + res.status + ')');
      }
      const buf = await res.arrayBuffer();
      const wb = XLSX.read(buf, {type:'array'});
      const ws = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, {defval:''});
      const normalized = normalizeRows(rows);
      
      if(normalized.length){
        baseData = normalized;
        dataStatusEl.innerHTML = `**japanese.xlsx** 자동 로드 완료. (총 ${baseData.length}개 단어)`;
      }else{
        throw new Error('엑셀 파일의 내용이 비어있습니다.');
      }
    }catch(err){
      console.warn('japanese.xlsx 자동 로딩 실패:', err.message);
      dataStatusEl.innerHTML = '<b>japanese.xlsx</b> 자동 로드 실패. [파일 선택]으로 로드해 주세요.';
    }
    render(baseData);
  })();
</script>
</body>
</html>
